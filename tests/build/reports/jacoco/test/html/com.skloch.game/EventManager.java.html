<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EventManager.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">tests</a> &gt; <a href="index.source.html" class="el_package">com.skloch.game</a> &gt; <span class="el_source">EventManager.java</span></div><h1>EventManager.java</h1><pre class="source lang-java linenums">package com.skloch.game;

import com.badlogic.gdx.scenes.scene2d.actions.Actions;
import com.badlogic.gdx.scenes.scene2d.actions.RunnableAction;
import com.badlogic.gdx.utils.Array;

import java.util.HashMap;
import java.util.concurrent.ThreadLocalRandom;

/**
 * A class that maps Object's event strings to actual Java functions.
 */
public class EventManager {
    private final GameScreen game;
    public HashMap&lt;String, Integer&gt; activityEnergies;
    private final HashMap&lt;String, String&gt; objectInteractions;
    private final Array&lt;String&gt; talkTopics;

    /**
     * A class that maps Object's event strings to actual Java functions.
     * To run a function call event(eventString), to add arguments add dashes.
     * E.g. a call to the Piazza function with an arg of 1 would be: &quot;piazza-1&quot;
     * Which the function interprets as &quot;study at the piazza for 1 hour&quot;.
     * Object's event strings can be set in the Tiled map editor with a property called &quot;event&quot;
     *
     * @param game An instance of the GameScreen containing a player and dialogue box
     */
<span class="nc" id="L28">    public EventManager (GameScreen game) {</span>
<span class="nc" id="L29">        this.game = game;</span>

        // How much energy an hour of each activity should take
<span class="nc" id="L32">        activityEnergies = new HashMap&lt;String, Integer&gt;();</span>
<span class="nc" id="L33">        activityEnergies.put(&quot;studying&quot;, 10);</span>
<span class="nc" id="L34">        activityEnergies.put(&quot;meet_friends&quot;, 10);</span>
<span class="nc" id="L35">        activityEnergies.put(&quot;eating&quot;, 10);</span>


        // Define what to say when interacting with an object who's text won't change
<span class="nc" id="L39">        objectInteractions = new HashMap&lt;String, String&gt;();</span>
<span class="nc" id="L40">        objectInteractions.put(&quot;chest&quot;, &quot;Open the chest?&quot;);</span>
<span class="nc" id="L41">        objectInteractions.put(&quot;comp_sci&quot;, &quot;Study in the Computer Science building?&quot;);</span>
<span class="nc" id="L42">        objectInteractions.put(&quot;piazza&quot;, &quot;Meet your friends at the Piazza?&quot;);</span>
<span class="nc" id="L43">        objectInteractions.put(&quot;accomodation&quot;, &quot;Go to sleep for the night?\nYour alarm is set for 8am.&quot;);</span>
<span class="nc" id="L44">        objectInteractions.put(&quot;rch&quot;, null); // Changes, dynamically returned in getObjectInteraction</span>
<span class="nc" id="L45">        objectInteractions.put(&quot;tree&quot;, &quot;Speak to the tree?&quot;);</span>

        // Some random topics that can be chatted about
<span class="nc" id="L48">        String[] topics = {&quot;Dogs&quot;, &quot;Cats&quot;, &quot;Exams&quot;, &quot;Celebrities&quot;, &quot;Flatmates&quot;, &quot;Video games&quot;, &quot;Sports&quot;, &quot;Food&quot;, &quot;Fashion&quot;};</span>
<span class="nc" id="L49">        talkTopics = new Array&lt;String&gt;(topics);</span>
<span class="nc" id="L50">    }</span>

    public void event (String eventKey) {
<span class="nc" id="L53">        String[] args = eventKey.split(&quot;-&quot;);</span>

        // Important functions, most likely called after displaying text
<span class="nc bnc" id="L56" title="All 2 branches missed.">        if (args[0].equals(&quot;fadefromblack&quot;)) {</span>
<span class="nc" id="L57">            fadeFromBlack();</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">        } else if (args[0].equals(&quot;fadetoblack&quot;)) {</span>
<span class="nc" id="L59">            fadeToBlack();</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">        } else if (args[0].equals(&quot;gameover&quot;)) {</span>
<span class="nc" id="L61">            game.GameOver();</span>
        }

        // Events related to objects
<span class="nc bnc" id="L65" title="All 8 branches missed.">        switch (args[0]) {</span>
            case &quot;tree&quot;:
<span class="nc" id="L67">                treeEvent();</span>
<span class="nc" id="L68">                break;</span>
            case &quot;chest&quot;:
<span class="nc" id="L70">                chestEvent();</span>
<span class="nc" id="L71">                break;</span>
            case &quot;piazza&quot;:
<span class="nc" id="L73">                piazzaEvent(args);</span>
<span class="nc" id="L74">                break;</span>
            case &quot;comp_sci&quot;:
<span class="nc" id="L76">                compSciEvent(args);</span>
<span class="nc" id="L77">                break;</span>
            case &quot;rch&quot;:
<span class="nc" id="L79">                ronCookeEvent(args);</span>
<span class="nc" id="L80">                break;</span>
            case &quot;accomodation&quot;:
<span class="nc" id="L82">                accomEvent(args);</span>
<span class="nc" id="L83">                break;</span>
            case &quot;exit&quot;:
                // Should do nothing and just close the dialogue menu
<span class="nc" id="L86">                game.dialogueBox.hide();</span>
<span class="nc" id="L87">                break;</span>
            default:
<span class="nc" id="L89">                objectEvent(eventKey);</span>
                break;

        }

<span class="nc" id="L94">    }</span>

    /**
     * Gets the interaction text associated with each object via a key
     * @param key
     * @return The object interaction text
     */
    public String getObjectInteraction(String key) {
<span class="nc bnc" id="L102" title="All 2 branches missed.">        if (key.equals(&quot;rch&quot;)) {</span>
<span class="nc" id="L103">            return String.format(&quot;Eat %s at the Ron Cooke Hub?&quot;, game.getMeal());</span>
        } else {
<span class="nc" id="L105">            return objectInteractions.get(key);</span>
        }
    }

    /**
     * @return True if the object has some custom text to display that isn't just &quot;This is an x!&quot;
     */
    public boolean hasCustomObjectInteraction(String key) {
<span class="nc" id="L113">        return objectInteractions.containsKey(key);</span>
    }

    /**
     * Sets the text when talking to a tree
     */
    public void treeEvent() {
<span class="nc" id="L120">        game.dialogueBox.hideSelectBox();</span>
<span class="nc" id="L121">        game.dialogueBox.setText(&quot;The tree doesn't say anything back.&quot;);</span>
<span class="nc" id="L122">    }</span>


    public void chestEvent() {
<span class="nc" id="L126">        game.dialogueBox.hideSelectBox();</span>
<span class="nc" id="L127">        game.dialogueBox.setText(&quot;Wow! This chest is full of so many magical items! I wonder how they will help you out on your journey! Boy, this is an awfully long piece of text, I wonder if someone is testing something?\n...\n...\n...\nHow cool!&quot;);</span>

<span class="nc" id="L129">    }</span>

    /**
     * Sets the text when talking to an object without a dedicated function
     */
    public void objectEvent(String object) {
<span class="nc" id="L135">        game.dialogueBox.hideSelectBox();</span>
<span class="nc" id="L136">        game.dialogueBox.setText(&quot;This is a &quot; +  object + &quot;!&quot;);</span>
<span class="nc" id="L137">    }</span>

    /**
     * Lets the player study at the piazza for x num of hours, decreases the player's energy and increments the
     * game time.
     *
     * @param args Arguments to be passed, should contain the hours the player wants to study. E.g. [&quot;piazza&quot;, &quot;1&quot;]
     */
    public void piazzaEvent(String[] args) {
<span class="nc bnc" id="L146" title="All 2 branches missed.">        if (game.getSeconds() &gt; 8*60) {</span>
<span class="nc" id="L147">            int energyCost = activityEnergies.get(&quot;meet_friends&quot;);</span>
            // If the player is too tired to meet friends
<span class="nc bnc" id="L149" title="All 2 branches missed.">            if (game.getEnergy() &lt; energyCost) {</span>
<span class="nc" id="L150">                game.dialogueBox.setText(&quot;You are too tired to meet your friends right now!&quot;);</span>

<span class="nc bnc" id="L152" title="All 2 branches missed.">            } else if (args.length == 1) {</span>
                // Ask the player to chat about something (makes no difference)
<span class="nc" id="L154">                String[] topics = randomTopics(3);</span>
<span class="nc" id="L155">                game.dialogueBox.setText(&quot;What do you want to chat about?&quot;);</span>
<span class="nc" id="L156">                game.dialogueBox.getSelectBox().setOptions(topics, new String[]{&quot;piazza-&quot;+topics[0], &quot;piazza-&quot;+topics[1], &quot;piazza-&quot;+topics[2]});</span>
<span class="nc" id="L157">            } else {</span>
                // Say that the player chatted about this topic for 1-3 hours
                // RNG factor adds a slight difficulty (may consume too much energy to study)
<span class="nc" id="L160">                int hours = ThreadLocalRandom.current().nextInt(1, 4);</span>
<span class="nc" id="L161">                game.dialogueBox.setText(String.format(&quot;You talked about %s for %d hours!&quot;, args[1].toLowerCase(), hours));</span>
<span class="nc" id="L162">                game.decreaseEnergy(energyCost * hours);</span>
<span class="nc" id="L163">                game.passTime(hours * 60); // in seconds</span>
<span class="nc" id="L164">                game.addRecreationalHours(hours);</span>
            }
<span class="nc" id="L166">        } else {</span>
<span class="nc" id="L167">            game.dialogueBox.setText(&quot;It's too early in the morning to meet your friends, go to bed!&quot;);</span>
        }
<span class="nc" id="L169">    }</span>

    /**
     * @param amount The amount of topics to return
     * @return An array of x random topics the player can chat about
     */
    private String[] randomTopics(int amount) {
        // Returns an array of 3 random topics
<span class="nc" id="L177">        Array&lt;String&gt; topics = new Array&lt;String&gt;(amount);</span>

<span class="nc bnc" id="L179" title="All 2 branches missed.">        for (int i = 0;i&lt;amount;i++) {</span>
<span class="nc" id="L180">            String choice = talkTopics.random();</span>
            // If statement to ensure topic hasn't already been selected
<span class="nc bnc" id="L182" title="All 2 branches missed.">            if (!topics.contains(choice, false)) {</span>
<span class="nc" id="L183">                topics.add(choice);</span>
            } else {
<span class="nc" id="L185">                i -= 1;</span>
            }
        }

<span class="nc" id="L189">        return topics.toArray(String.class);</span>
    }

    /**
     * The event to be run when interacting with the computer science building
     * Gives the player the option to study for 2, 3 or 4 hours
     * @param args
     */
    public void compSciEvent(String[] args) {
<span class="nc bnc" id="L198" title="All 2 branches missed.">        if (game.getSeconds() &gt; 8*60) {</span>
<span class="nc" id="L199">            int energyCost = activityEnergies.get(&quot;studying&quot;);</span>
            // If the player is too tired for any studying:
<span class="nc bnc" id="L201" title="All 2 branches missed.">            if (game.getEnergy() &lt; energyCost) {</span>
<span class="nc" id="L202">                game.dialogueBox.hideSelectBox();</span>
<span class="nc" id="L203">                game.dialogueBox.setText(&quot;You are too tired to study right now!&quot;);</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">            } else if (args.length == 1) {</span>
                // If the player has not yet chosen how many hours, ask
<span class="nc" id="L206">                game.dialogueBox.setText(&quot;Study for how long?&quot;);</span>
<span class="nc" id="L207">                game.dialogueBox.getSelectBox().setOptions(new String[]{&quot;2 Hours (20)&quot;, &quot;3 Hours (30)&quot;, &quot;4 Hours (40)&quot;}, new String[]{&quot;comp_sci-2&quot;, &quot;comp_sci-3&quot;, &quot;comp_sci-4&quot;});</span>
            } else {
<span class="nc" id="L209">                int hours = Integer.parseInt(args[1]);</span>
                // If the player does not have enough energy for the selected hours
<span class="nc bnc" id="L211" title="All 2 branches missed.">                if (game.getEnergy() &lt; hours*energyCost) {</span>
<span class="nc" id="L212">                    game.dialogueBox.setText(&quot;You don't have the energy to study for this long!&quot;);</span>
                } else {
                    // If they do have the energy to study
<span class="nc" id="L215">                    game.dialogueBox.setText(String.format(&quot;You studied for %s hours!\nYou lost %d energy&quot;, args[1], hours*energyCost));</span>
<span class="nc" id="L216">                    game.decreaseEnergy(energyCost * hours);</span>
<span class="nc" id="L217">                    game.addStudyHours(hours);</span>
<span class="nc" id="L218">                    game.passTime(hours * 60); // in seconds</span>
                }
            }
<span class="nc" id="L221">        } else {</span>
<span class="nc" id="L222">            game.dialogueBox.setText(&quot;It's too early in the morning to study, go to bed!&quot;);</span>
        }
<span class="nc" id="L224">    }</span>


    /**
     * The event to be run when the player interacts with the ron cooke hub
     * Gives the player the choice to eat breakfast, lunch or dinner depending on the time of day
     * @param args
     */
    public void ronCookeEvent(String[] args) {
<span class="nc bnc" id="L233" title="All 2 branches missed.">        if (game.getSeconds() &gt; 8*60) {</span>
<span class="nc" id="L234">            int energyCost = activityEnergies.get(&quot;eating&quot;);</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">            if (game.getEnergy() &lt; energyCost) {</span>
<span class="nc" id="L236">                game.dialogueBox.setText(&quot;You are too tired to eat right now!&quot;);</span>
            } else {
<span class="nc" id="L238">                game.dialogueBox.setText(String.format(&quot;You took an hour to eat %s at the Ron Cooke Hub!\nYou lost %d energy!&quot;, game.getMeal(), energyCost));</span>
<span class="nc" id="L239">                game.decreaseEnergy(energyCost);</span>
<span class="nc" id="L240">                game.passTime(60); // in seconds</span>
            }
<span class="nc" id="L242">        } else {</span>
<span class="nc" id="L243">            game.dialogueBox.setText(&quot;It's too early in the morning to eat food, go to bed!&quot;);</span>
        }

<span class="nc" id="L246">    }</span>

    /**
     * Lets the player go to sleep, fades the screen to black then shows a dialogue about the amount of sleep
     * the player gets
     * Then queues up fadeFromBlack to be called when this dialogue closes
     * @see GameScreen fadeToBlack function
     * @param args Unused currently
     */
    public void accomEvent(String[] args) {
<span class="nc" id="L256">        game.setSleeping(true);</span>
<span class="nc" id="L257">        game.dialogueBox.hide();</span>

        // Calculate the hours slept to the nearest hour
        // Wakes the player up at 8am
        float secondsSlept;
<span class="nc bnc" id="L262" title="All 2 branches missed.">        if (game.getSeconds() &lt; 60*8) {</span>
<span class="nc" id="L263">            secondsSlept = (60*8 - game.getSeconds());</span>
        } else {
            // Account for the wakeup time being in the next day
<span class="nc" id="L266">            secondsSlept = (((60*8) + 1440) - game.getSeconds());</span>
        }
<span class="nc" id="L268">        int hoursSlept = Math.round(secondsSlept / 60f);</span>

<span class="nc" id="L270">        RunnableAction setTextAction = new RunnableAction();</span>
<span class="nc" id="L271">        setTextAction.setRunnable(new Runnable() {</span>
            @Override
            public void run() {
<span class="nc bnc" id="L274" title="All 2 branches missed.">                if (game.getSleeping()) {</span>
<span class="nc" id="L275">                    game.dialogueBox.show();</span>
<span class="nc" id="L276">                    game.dialogueBox.setText(String.format(&quot;You slept for %d hours!\nYou recovered %d energy!&quot;, hoursSlept, Math.min(100, hoursSlept*13)), &quot;fadefromblack&quot;);</span>
                    // Restore energy and pass time
<span class="nc" id="L278">                    game.setEnergy(hoursSlept*13);</span>
<span class="nc" id="L279">                    game.passTime(secondsSlept);</span>
<span class="nc" id="L280">                    game.addSleptHours(hoursSlept);</span>
                }
<span class="nc" id="L282">            }</span>
        });

<span class="nc" id="L285">        fadeToBlack(setTextAction);</span>
<span class="nc" id="L286">    }</span>

    /**
     * Fades the screen to black
     */
    public void fadeToBlack() {
<span class="nc" id="L292">        game.blackScreen.addAction(Actions.fadeIn(3f));</span>
<span class="nc" id="L293">    }</span>

    /**
     * Fades the screen to black, then runs a runnable after it is done
     * @param runnable A runnable to execute after fading is finished
     */
    public void fadeToBlack(RunnableAction runnable) {
<span class="nc" id="L300">        game.blackScreen.addAction(Actions.sequence(Actions.fadeIn(3f), runnable));</span>
<span class="nc" id="L301">    }</span>

    /**
     * Fades the screen back in from black, displays a good morning message if the player was sleeping
     */
    public void fadeFromBlack() {
        // If the player is sleeping, queue up a message to be sent
<span class="nc bnc" id="L308" title="All 2 branches missed.">        if (game.getSleeping()) {</span>
<span class="nc" id="L309">            RunnableAction setTextAction = new RunnableAction();</span>
<span class="nc" id="L310">            setTextAction.setRunnable(new Runnable() {</span>
                  @Override
                  public void run() {
<span class="nc bnc" id="L313" title="All 2 branches missed.">                      if (game.getSleeping()) {</span>
<span class="nc" id="L314">                          game.dialogueBox.show();</span>
                          // Show a text displaying how many days they have left in the game
<span class="nc" id="L316">                          game.dialogueBox.setText(game.getWakeUpMessage());</span>
<span class="nc" id="L317">                          game.setSleeping(false);</span>
                      }
<span class="nc" id="L319">                  }</span>
              });

            // Queue up events
<span class="nc" id="L323">            game.blackScreen.addAction(Actions.sequence(Actions.fadeOut(3f), setTextAction));</span>
<span class="nc" id="L324">        } else {</span>
<span class="nc" id="L325">            game.blackScreen.addAction(Actions.fadeOut(3f));</span>
        }
<span class="nc" id="L327">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>